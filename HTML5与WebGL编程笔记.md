## HTML5与WebGL编程笔记
网购该书，甚是兴奋，开看！不过和之前自己找的网络资料有很多重复之处，再看一遍就当巩固复习了吧。

### 绪论
3d技术的发展过程是曲折的，直至今日才逐渐成熟，html5对3d的应用加快了该技术的普及。
#### 3d图形基本知识
1. 什么是3d
额，想想就明白了
2. 3d坐标系
需注意3d坐标系与canvas坐标系的区别，一个向上一个向下。
3. 网格、多边形与顶点
这几个要素构成3d模型，但不决定色彩与明暗
4. 材质、纹理与光源
5.变换与矩阵
可参考:http://www.songho.ca/opengl/gl_transform.html
6. 相机、透视、视口与投影
透视(即远处的物体看起来比较小).投影矩阵(3d坐标到视口的2d绘制空间坐标的转换)
7. 着色器
材质、光源、变换以及相机由其处理，css3滤镜与webgl绘制都依赖于着色器，2d cavas api是不支持的。

### WebGL: 实时3d渲染
#### 步骤
1. 创建一个canvas元素
2. 获取绘图上下文
3. 初始化视口
4. 创建一个或多个包含待渲染数据的缓冲(一般是顶点)
5. 创建一个或多个顶点缓冲到屏幕空间转换规则的矩阵
6. 创建一个或多个实现绘制算法的着色器
7. 使用各项参数初始化着色气器
8. 绘制

#### 索引缓冲
能够避免数据重复，令数据存储更加紧凑，但是索引的构造原理是什么？

####  开启深度测试
其按照深度排序来绘制立方体，不开启的话无法区分"前方"和"后方"，造成图形显示不全
```javascript
gl.enable(gl.DEPTH_TEST);
```

#### 纹理
纹理映射使用到图片时必须基于web服务器，其对跨域做了一定要求，觉得很有趣的是其可以使用视频作为构建源
```javascript
//绑定纹理
gl.bindTexture(gl.TEXTURE_2D, texture);
// 翻转纹理坐标
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
// 复制图像到纹理对象
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.image);
// 纹理计算方式
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
// 防止意外更改存储区域
gl.bindTexture(gl.TEXTURE_2D, null);
```

### threejs简介
从这个游戏的效果来说还是很不错的：http://hexgl.bkcore.com/play/  
此外对比下代码量，瞬间信心上来了。  

### threejs中的图形与渲染
挤出几何体是什么？  
纹理坐标又称为UV，U和V分别代表纹理坐标的水平轴和垂直轴  
BufferGeometry可以优化网格渲染，适用于顶点值不会改变且不会再场景中移动的固定物体  
#### 利用场景图管理复杂场景
可以想象为沿某轨道运动的汽车与汽车轮子的关系。  
图对threejs描述并不准确，其实是一种树的关系。  
每次渲染的时候都会遍历整个场景图的叶节点来计算每个物体的变换矩阵。    

#### 三种材质
* unlit,场景的光照对物体的外观不会产生影响
* Phong,光线直接照射的地方显示高光区域,物体表面的亮度随着物体到光源的距离而衰减
* Lambertian reflectance,物体外观明暗不随观察者视角的改变而改变

#### 光源
光源本身对场景没有影响，必须和材质结合起来才有意义。光源种类:
* 定向光,只有方向、颜色和强度信息
* 点光源,只包含位置
* 聚光灯,包含位置和方向，以及内圆锥、外圆锥、照亮距离
* 环境光,无位置，无方向.均匀投射·

#### 三种阴影贴图算法
每种算法比前一种更接近真实效果，但是性能也会随之下降  
1. basic
2. PCF(percentage close filtering)
3. PCF soft shadows  

暗度值设为0.5很适合应用,此外*shadowDarkness*是需要手动设置的

#### 着色器
GLSL，GL着色器语言  
uniform与varying,一个计算一次，一个在每个节点中都会计算  
着色器代码的书写得多看，没咋看懂。特别是基于相机方向、法向量和折射率来计算反射与折射向量信息。

#### 渲染
深度缓冲需要自个指定物理排序
高级渲染技术包括不限于后处理、多道渲染(多次渲染形成图像)、延迟渲染(耗费存储空间、需要计算能力)。


### 3d动画
requestAnimationFrame是动画的不二之选。优点:  
1. 自动优化调用，在tab页隐藏时可以自动调整
2. 可以批量处理
3. 可以与其它绘图操作合并  

节拍动画与时间动画、插值计算(A+u*/(B - A)),当然我们还可以直接使用tweenjs库。此外还有缓动、关键帧(如水中浮动的箱子应用、
关节应用)、使用曲线构建平滑动画、使用变形目标来创建人物与面部动画(每个元素都是一个单独的变形目标，包含全部顶点，只是顶点位置各不相同而已)、蒙皮构建角色动画(又称为骨骼动画或单网格动画)、着色器(非j代码，要求高，不仅得懂GLSL和内置函数，还得掌握一些深奥的计算机图形算法)

### css3高级页面特效
将html内容作为纹理映射到3d物体上  
preserve-3d用于将上级变换应用于子级，麻烦的是Firefox需要显式指定该值  
backface-visibility可以控制3d背面渲染  
令人惊讶的是css3居然可以做出很炫的效果如：射击游戏(构建过程异常复杂)、3d字母表(需要大量重复html元素)、高级着色器效果(css3滤镜)等

### canvas 2D绘图
context.createPattern函数可用来创建平铺  
context.beginPath/context.closePath 重置笔状态/与第一个顶点连接起来  
context.save/context.restore  状态保存/状态恢复  
能用硬件渲染的时候使用软件渲染并不是一个好办法，软件渲染基本无深度缓存(占用内存)而使用三角形排序的方法  
基于canvas的3d渲染库k3d远么有其声明的强大，但是从threejs使用canvas做降级方案的效果来看还是不错的，其适合用来做3d全景图以及汇至大量简单的2d多边形

### 3d内容制作流程
webgl正在经历早年web类似的演变(没编辑器?)  
建模-->贴图-->动画-->美工  
留意各种3d编辑器，从价格昂贵的专业工具到新兴的开源工具都有很多选择，开源的有如Blender  
#### 基于浏览器的集成环境
1. Verold:轻量级3d交互内容发布平台
2. SculptGL:免费开源的建模工具  

#### 3d仓库和内容素材
1. 3drt.com: 专业人士用
2. renderosity:用于预渲染静态图像的高多边形模型
3. turbosquid:包含成千上万模型的一流网站
#### 3d文件格式
模型格式(OBJ,STL)
动画格式(MD2/MD5,BVH等)
全功能场景格式,作者详细介绍了gltf
作者详细介绍了使用threejs加载COLLADA场景与glTF场景

### 3d引擎与框架
作者详细介绍了框架设计的逻辑，有一句话引起了我的共鸣，框架提供的90%的功能在早期让我们过度自信，然后在实现10%的功能的时候变得异常复杂。使用这些框架可以大大的减少我们重复的工作，能够赋予3d开发更多的活力。
#### 框架概况
1. playcanvas
功能丰富，提供云编辑功能。
2. turblenz
开源免费的游戏引擎，学习路线陡峭，适合经验丰富的开发者
3. Goo Engine
内部测试阶段(过了这么久该不是了吧)
4. Babylon
微软推动，功能与易用性介于threejs与专业游戏引擎之间

#### 展示框架
tquery、voodoojs、PhiloGL  
Vizi:该书作者开发，基于组件的对象模型，即从传统的继承转向了组件的集合。

### 开发一个3d应用
即“未来车”的概念设计。
主要用来讲解3d框架的运用实践了。

### 开发一个3d环境
即使得“未来车”在某个环境中开起来。


### 开发移动3d应用‘
“未来车”怎么在手机上跑起来。

### 附录
资源集